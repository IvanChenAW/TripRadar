<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TripRadarï½œè¡Œå‰ 1 åˆ†é˜ Â· å»ºè­°æ—…éŠåˆ†æ•¸ + äº¤é€šèˆ‡ç½å®³é¢¨éšª</title>
<style>
  :root{
    --bg:#f5f7fb; --card:#fff; --text:#0f172a; --muted:#64748b; --brand:#2563eb;
    --green:#16a34a; --blue:#2563eb; --amber:#d97706; --red:#dc2626;
    --chip:#eef2ff; --chipText:#1e293b; --pill:#eef2ff;
    --shadow:0 10px 24px rgba(15,23,42,.08);
    --radius:16px;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family: "Noto Sans TC", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang TC", "Microsoft JhengHei", Arial, sans-serif}
  header{
    background:linear-gradient(180deg,#3576ff 0%, #2c5df2 60%, #2248da 100%);
    color:#fff;padding:28px 20px 24px;position:sticky;top:0;z-index:10;
  }
  .wrap{max-width:1200px;margin:0 auto}
  h1{margin:0;font-size:28px;letter-spacing:1px}
  .sub{opacity:.92;margin-top:6px}
  .toolbar{display:flex;gap:12px;flex-wrap:wrap;margin-top:16px}
  .btn{background:#fff;color:#0f172a;border:none;border-radius:999px;padding:10px 16px;font-weight:700;box-shadow:var(--shadow);display:inline-flex;gap:10px;align-items:center}
  .btn.primary{background:#0ea5e9;color:#fff}
  .btn:active{transform:translateY(1px)}
  .row{max-width:1200px;margin:18px auto 0;padding:0 16px;display:flex;gap:12px;flex-wrap:wrap}
  .chip{background:var(--chip);color:var(--chipText);padding:8px 12px;border-radius:999px;font-weight:700}
  .ctl{background:var(--card);box-shadow:var(--shadow);border-radius:var(--radius);padding:14px 16px;display:flex;gap:12px;align-items:center}
  .ctl select,.ctl input[type="checkbox"]{font-size:16px}
  .grid{max-width:1200px;margin:16px auto;padding:0 16px;display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  @media (max-width:1024px){.grid{grid-template-columns:repeat(8,1fr)}}
  @media (max-width:640px){.grid{grid-template-columns:repeat(4,1fr)}}
  .card{grid-column:span 6;background:var(--card);box-shadow:var(--shadow);border-radius:var(--radius);padding:18px}
  @media (max-width:640px){.card{grid-column:span 4}}
  .title{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .title h3{margin:0;font-size:22px}
  .badge{background:#f1f5ff;border-radius:999px;padding:8px 12px;font-weight:800}
  .badge.green{background:#ecfdf5;color:var(--green)}
  .badge.blue{background:#eff6ff;color:var(--blue)}
  .badge.amber{background:#fff7ed;color:var(--amber)}
  .badge.red{background:#fef2f2;color:var(--red)}
  .meta{color:var(--muted);margin:6px 0 10px}
  .metrics{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 12px}
  .pill{background:var(--pill);padding:8px 12px;border-radius:12px;font-weight:700}
  .acts{display:flex;flex-wrap:wrap;gap:10px;margin-top:8px}
  .actBtn{flex:0 0 auto;border:1px solid #e5e7eb;background:#fff;border-radius:12px;padding:10px 12px;display:flex;gap:10px;align-items:center;cursor:pointer}
  .src{max-width:1200px;margin:10px auto 26px;padding:0 16px;color:var(--muted)}
  footer{color:#94a3b8;text-align:center;margin:36px 0 16px}
  .muted{color:var(--muted)}
</style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>TripRadar</h1>
      <div class="sub">è¡Œå‰ 1 åˆ†é˜ï½œå»ºè­°æ—…éŠåˆ†æ•¸ + ä¸€å¥å»ºè­°</div>
      <div class="toolbar">
        <button id="btnRefresh" class="btn">ğŸ”„ é‡æ–°æŠ“å–</button>
        <div id="txtTime" class="btn">ğŸ•’ æ›´æ–°æ™‚é–“ï¼šâ€”</div>
      </div>
    </div>
  </header>

  <section class="row">
    <div class="ctl">
      <input id="useGeo" type="checkbox" checked />
      <label for="useGeo"><b>ä½¿ç”¨æ‰€åœ¨åœ°åŠ æ¬Š</b></label>
    </div>
    <div class="ctl">
      <span class="muted">æ‰‹å‹•æ‰€åœ¨åœ°ï¼š</span>
      <select id="selCity">
        <option>è‡ºåŒ—å¸‚</option><option>æ–°åŒ—å¸‚</option><option>æ¡ƒåœ’å¸‚</option>
        <option>æ–°ç«¹å¸‚</option><option>æ–°ç«¹ç¸£</option><option>è‹—æ —ç¸£</option>
        <option>è‡ºä¸­å¸‚</option><option>å½°åŒ–ç¸£</option><option>å—æŠ•ç¸£</option>
        <option>é›²æ—ç¸£</option><option>å˜‰ç¾©ç¸£</option><option>å˜‰ç¾©å¸‚</option>
        <option>è‡ºå—å¸‚</option><option>é«˜é›„å¸‚</option><option>å±æ±ç¸£</option>
        <option>å®œè˜­ç¸£</option><option>èŠ±è“®ç¸£</option><option>è‡ºæ±ç¸£</option>
      </select>
    </div>
  </section>

  <section class="row">
    <div class="chip">CWBï¼šå¤©æ°£ï¼ˆå±•ç¤ºç”¨å‡è³‡æ–™ï¼‰</div>
    <div class="chip">MoENVï¼šAQIï¼ˆå±•ç¤ºç”¨å‡è³‡æ–™ï¼‰</div>
    <div class="chip">NCDRï¼šç½å®³ CAPï¼ˆå±•ç¤ºç”¨å‡è³‡æ–™ï¼‰</div>
    <div class="chip">TDXï¼šè½‰ä¹˜ / è·¯æ³ï¼ˆå±•ç¤ºç”¨å‡è³‡æ–™ï¼‰</div>
  </section>

  <section id="cards" class="grid"></section>

  <div class="src wrap">è³‡æ–™ä¾†æºï¼šCWB F-C0032-001ã€MoENV aqi_p_432ã€NCDR CAPã€TDXï¼ˆæ­¤é ç‚ºå±•ç¤ºç‰ˆï¼Œå¯¦éš›ç«¶è³½å¯åˆ‡æ›æˆçœŸ APIï¼‰</div>
  <footer>Â© 2025 TripRadarï¼ˆDEMOï¼‰</footer>

<script>
/* =========================
   0) å±•ç¤ºæ¨¡å¼ï¼ˆä¸é€£å¤–ï¼‰
   ========================= */
const DEMO_MODE = true;

/* =========================
   1) åŸºæœ¬è³‡æ–™ï¼š13 è™•åœ‹å®¶é¢¨æ™¯å€
   ========================= */
const spots = [
  { name: "é˜¿é‡Œå±±",  region: "å˜‰ç¾©ç¸£", lat: 23.508, lng: 120.81,  url: "https://www.ali-nsa.net/" },
  { name: "å¤ªé­¯é–£",  region: "èŠ±è“®ç¸£", lat: 24.18,  lng: 121.49,  url: "https://www.taroko.gov.tw/" },
  { name: "æ—¥æœˆæ½­",  region: "å—æŠ•ç¸£", lat: 23.86,  lng: 120.91,  url: "https://www.sunmoonlake.gov.tw/" },
  { name: "è¥¿æ‹‰é›…",  region: "è‡ºå—å¸‚", lat: 23.18,  lng: 120.40,  url: "https://www.siraya-nsa.gov.tw/" },
  { name: "èŠ±æ±ç¸±è°·",region: "èŠ±è“®ç¸£", lat: 23.90,  lng: 121.54,  url: "https://www.erv-nsa.gov.tw/" },
  { name: "æ±éƒ¨æµ·å²¸",region: "è‡ºæ±ç¸£", lat: 22.90,  lng: 121.16,  url: "https://www.eastcoast-nsa.gov.tw/" },
  { name: "åŒ—æµ·å²¸åŠè§€éŸ³å±±",region:"æ–°åŒ—å¸‚", lat: 25.28, lng: 121.56, url:"https://www.northguan-nsa.gov.tw/" },
  { name: "èŒ‚æ—",    region: "é«˜é›„å¸‚", lat: 22.88,  lng: 120.68,  url: "https://www.maolin-nsa.gov.tw/" },
  { name: "æ¾æ¹–",    region: "æ¾æ¹–ç¸£", lat: 23.57,  lng: 119.56,  url: "https://www.penghu-nsa.gov.tw/" },
  { name: "é¦¬ç¥–",    region: "é€£æ±Ÿç¸£", lat: 26.16,  lng: 119.93,  url: "https://www.matsu-nsa.gov.tw/" },
  { name: "é›²å˜‰å—æ¿±æµ·",region:"é›²æ—ç¸£", lat: 23.37, lng: 120.15, url:"https://www.swcoast-nsa.gov.tw/" },
  { name: "é‡‘é–€",    region: "é‡‘é–€ç¸£", lat: 24.45,  lng: 118.39,  url: "https://www.kinmen-nsa.gov.tw/" },
  { name: "æ±åŒ—è§’æš¨å®œè˜­æµ·å²¸",region:"å®œè˜­ç¸£", lat: 24.98, lng: 121.91, url:"https://www.necoast-nsa.gov.tw/" }
];

/* =========================
   2) å±•ç¤ºç”¨æ¨¡æ“¬è³‡æ–™ï¼ˆå¤©æ°£ / AQI / ç½å®³ / è·¯æ³ï¼‰
   ========================= */
const weatherData = { // æ¯ç¸£å¸‚ï¼šæº«åº¦ã€é™é›¨æ©Ÿç‡ã€UVã€AQI
  "å˜‰ç¾©ç¸£":{temp:24,pop:20,uv:6,aqi:45}, "èŠ±è“®ç¸£":{temp:25,pop:30,uv:7,aqi:50},
  "å—æŠ•ç¸£":{temp:23,pop:25,uv:7,aqi:40}, "è‡ºå—å¸‚":{temp:26,pop:10,uv:8,aqi:55},
  "è‡ºæ±ç¸£":{temp:26,pop:15,uv:8,aqi:35}, "æ–°åŒ—å¸‚":{temp:24,pop:20,uv:6,aqi:48},
  "é«˜é›„å¸‚":{temp:27,pop:20,uv:9,aqi:60}, "æ¾æ¹–ç¸£":{temp:25,pop:10,uv:8,aqi:38},
  "é€£æ±Ÿç¸£":{temp:20,pop:15,uv:5,aqi:30}, "é›²æ—ç¸£":{temp:25,pop:20,uv:7,aqi:50},
  "é‡‘é–€ç¸£":{temp:22,pop:10,uv:6,aqi:32}, "å®œè˜­ç¸£":{temp:23,pop:35,uv:6,aqi:42}
};

const disasterData = { // 0=ç„¡ã€1=æ³¨æ„ã€2=è­¦å ±ï¼ˆç°¡åŒ–ï¼‰
  "å˜‰ç¾©ç¸£":0,"èŠ±è“®ç¸£":0,"å—æŠ•ç¸£":0,"è‡ºå—å¸‚":0,"è‡ºæ±ç¸£":0,"æ–°åŒ—å¸‚":0,
  "é«˜é›„å¸‚":0,"æ¾æ¹–ç¸£":0,"é€£æ±Ÿç¸£":0,"é›²æ—ç¸£":1,"é‡‘é–€ç¸£":0,"å®œè˜­ç¸£":0
};

const trafficData = { // 0=é †ã€1=è»Šå¤šã€2=å£…å¡ï¼ˆç°¡åŒ–ï¼‰
  "å˜‰ç¾©ç¸£":1,"èŠ±è“®ç¸£":0,"å—æŠ•ç¸£":0,"è‡ºå—å¸‚":0,"è‡ºæ±ç¸£":0,"æ–°åŒ—å¸‚":1,
  "é«˜é›„å¸‚":1,"æ¾æ¹–ç¸£":0,"é€£æ±Ÿç¸£":0,"é›²æ—ç¸£":1,"é‡‘é–€ç¸£":0,"å®œè˜­ç¸£":1
};

/* =========================
   3) æ‰“åˆ†é‚è¼¯
   ========================= */
function baseScore({temp,pop,uv,aqi}){
  let s = 75; // ä»¥ 75 ç‚ºåŸºæº–
  // æº«åº¦ï¼šé›¢ 23Â°C æ¯ Â±1Â°C æ‰£ 1 åˆ†ï¼Œæœ€å¤šæ‰£ 10
  s -= Math.min(10, Math.abs(temp-23)*1);
  // é™é›¨ï¼š100% æ‰£ 20 â†’ ç·šæ€§
  s -= (pop/100)*20;
  // AQIï¼šæ¯ +1 æ‰£ 0.8ï¼ˆAQI 50 ç´„æ‰£ 40ï¼‰
  s -= (aqi)*0.8/2; // é™ä½ä¸€åŠå½±éŸ¿ï¼ˆ/2ï¼‰ä»¥è¼ƒç¬¦åˆæ—…éŠæ„Ÿå—
  // UVï¼šé«˜ UV ä¸ç›´æ¥åˆ¤å®šå±éšªï¼Œçµ¦è¼•å¾® -3..0
  if(uv>=9)s-=3; else if(uv>=7)s-=2; else if(uv>=6)s-=1;
  return Math.max(0, Math.min(95, Math.round(s)));
}

function locationAdjust(spotRegion, userCity){
  if(!document.getElementById('useGeo').checked) return 0;
  if(!userCity) return 0;
  // åŒç¸£å¸‚ +5ï¼Œè¿‘å€ +2ï¼ˆç°¡åŒ–ä»¥å­—é¢åˆ¤æ–·ï¼‰
  if(spotRegion.includes(userCity) || userCity.includes(spotRegion)) return +5;
  const near = [
    ["è‡ºåŒ—å¸‚","æ–°åŒ—å¸‚","åŸºéš†å¸‚","å®œè˜­ç¸£"],
    ["æ–°åŒ—å¸‚","è‡ºåŒ—å¸‚","åŸºéš†å¸‚","å®œè˜­ç¸£","æ¡ƒåœ’å¸‚"],
    ["è‡ºä¸­å¸‚","å—æŠ•ç¸£","å½°åŒ–ç¸£","è‹—æ —ç¸£"],
    ["è‡ºå—å¸‚","é«˜é›„å¸‚","å˜‰ç¾©ç¸£","é›²æ—ç¸£","å±æ±ç¸£"]
  ];
  const line = near.find(g => g.includes(userCity));
  if(line && line.some(x => spotRegion.includes(x))) return +2;
  return 0;
}

function riskPenalty(spotRegion){
  // ç½å®³ï¼šæ³¨æ„ -5ï¼›è­¦å ± -15
  const d = disasterData[spotRegion] ?? 0;
  const pDis = d===2 ? -15 : d===1 ? -5 : 0;
  // è·¯æ³ï¼šå£…å¡ -8ï¼›è»Šå¤š -3
  const t = trafficData[spotRegion] ?? 0;
  const pTra = t===2 ? -8 : t===1 ? -3 : 0;
  return pDis + pTra;
}

function finalScore(spotRegion, userCity, metrics){
  const s0 = baseScore(metrics);
  const adj = locationAdjust(spotRegion, userCity);
  const pen = riskPenalty(spotRegion);
  return Math.max(0, Math.min(100, s0 + adj + pen));
}

function colorOf(score){
  if(score>=90) return {cls:"green", text:"éå¸¸é©åˆå‡ºéŠ", emoji:"ğŸŸ¢"};
  if(score>=75) return {cls:"blue",  text:"é©åˆå‡ºéŠ",     emoji:"ğŸ”µ"};
  if(score>=60) return {cls:"amber", text:"å°šå¯å‡ºéŠ",     emoji:"ğŸŸ¡"};
  return {cls:"red",   text:"å»ºè­°æ”¹æœŸ",     emoji:"ğŸ”´"};
}

/* =========================
   4) äº’å‹•ï¼šåœ°åœ–ï¼å°èˆªï¼å®˜ç¶²
   ========================= */
function openMapAt(lat,lng){
  const ua=navigator.userAgent.toLowerCase();
  const apple=`http://maps.apple.com/?ll=${lat},${lng}`;
  const google=`https://maps.google.com/?q=${lat},${lng}`;
  if(/iphone|ipad|macintosh/.test(ua)) window.open(apple,'_blank');
  else window.open(google,'_blank');
}
function navTo(lat,lng){
  const ua=navigator.userAgent.toLowerCase();
  const apple=`http://maps.apple.com/?daddr=${lat},${lng}`;
  const google=`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
  if(/iphone|ipad|macintosh/.test(ua)) window.open(apple,'_blank');
  else window.open(google,'_blank');
}

/* =========================
   5) ç”¢ç”Ÿå¡ç‰‡
   ========================= */
function render(){
  const container = document.getElementById('cards');
  container.innerHTML = '';
  const userCity = document.getElementById('selCity').value;

  spots.forEach(sp => {
    const met = weatherData[sp.region] || {temp:24,pop:20,uv:6,aqi:45};
    const score = finalScore(sp.region, userCity, met);
    const color = colorOf(score);

    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="title">
        <h3>${sp.name}</h3>
        <div class="badge ${color.cls}">${color.emoji} å»ºè­°æ—…éŠåˆ†æ•¸ ${score}</div>
      </div>
      <div class="meta">${sp.region}</div>
      <div class="metrics">
        <div class="pill">ğŸŒ¡ï¸ ${met.temp}Â°C</div>
        <div class="pill">ğŸŒ§ï¸ ${met.pop}%</div>
        <div class="pill">â˜€ï¸ UV ${met.uv}</div>
        <div class="pill">ğŸ«§ AQI ${met.aqi}</div>
      </div>
      <div class="acts">
        <button class="actBtn" data-act="pin">ğŸ“ ä¸€éµåˆ°é»</button>
        <button class="actBtn" data-act="nav">ğŸ—ºï¸ åœ°åœ–å°èˆª</button>
        <a class="actBtn" href="${sp.url}" target="_blank" rel="noopener">ğŸ“„ å®˜æ–¹ç¶²ç«™</a>
      </div>
    `;
    // ç¶å®š
    card.querySelector('[data-act="pin"]').onclick = () => openMapAt(sp.lat, sp.lng);
    card.querySelector('[data-act="nav"]').onclick = () => navTo(sp.lat, sp.lng);

    container.appendChild(card);
  });

  // æ›´æ–°æ™‚é–“
  const t = new Date();
  const pad = n => n.toString().padStart(2,'0');
  document.getElementById('txtTime').textContent =
    `ğŸ•’ æ›´æ–°æ™‚é–“ï¼š${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())} ${pad(t.getHours())}:${pad(t.getMinutes())}`;
}

/* =========================
   6) äº‹ä»¶
   ========================= */
document.getElementById('btnRefresh').addEventListener('click', render);
document.getElementById('selCity').addEventListener('change', render);
document.getElementById('useGeo').addEventListener('change', render);

// é¦–æ¬¡è¼‰å…¥
render();
</script>
</body>
</html>
