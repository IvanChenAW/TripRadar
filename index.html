<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>TripRadarï½œApp ä»‹é¢ï¼ˆDEMOï¼‰</title>

  <!-- é˜²å¿«å–ï¼Œé¿å…æ‰‹æ©Ÿé¡¯ç¤ºèˆŠç‰ˆ -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- å­—é«” -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --ink:#0d1b2a;
      --muted:#5b6b7a;
      --bg:#f6f8fb;
      --card:#fff;
      --prim:#2f6feb; /* ä¸»è— */
      --accent:#2ea043; /* æˆåŠŸç¶  */
      --amber:#f2a500; /* ç¥ç€é»ƒ */
      --danger:#e14d4d; /* ç´…è‰² */
      --chip:#eef2f7;
      --radius:16px;
    }
    *,*:before,*:after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:"Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      line-height:1.45;
    }

    /* é ‚éƒ¨ */
    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(180deg,#2856d3, #2f6feb);
      color:#fff;
      padding:14px 20px;
      box-shadow:0 6px 16px rgba(13,27,42,.15);
    }
    header .title{
      font-weight:900;letter-spacing:.5px;font-size:24px;
    }
    header .subtitle{
      opacity:.9;font-size:14px;margin-top:2px
    }
    header .toolbar{
      margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center
    }
    .pill{
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.25);
      padding:8px 12px;border-radius:999px;
      display:inline-flex;align-items:center;gap:8px;font-size:14px
    }
    .btn-refresh{
      background:#fff;color:#1f2328;border:none;cursor:pointer;
      border-radius:999px;padding:8px 14px;font-weight:700
    }

    main{padding:16px}

    /* ç¯©é¸ */
    .filters{
      display:flex;align-items:center;gap:12px;flex-wrap:wrap;
      margin-bottom:8px
    }
    .select, .switch{
      background:var(--card); border:1px solid #e5e9f0;
      border-radius:12px;padding:8px 12px
    }
    select{
      font-size:16px; border:none; background:transparent; outline:none
    }
    label.switch{display:flex;align-items:center;gap:8px}
    .muted{color:var(--muted)}

    /* å¡ç‰‡ */
    .grid{
      display:grid; gap:16px;
      grid-template-columns:repeat(1, minmax(0,1fr));
    }
    @media (min-width:680px){
      .grid{grid-template-columns:repeat(2, minmax(0,1fr))}
    }
    @media (min-width:980px){
      .grid{grid-template-columns:repeat(3, minmax(0,1fr))}
    }
    .card{
      background:var(--card); border:1px solid #e8edf4;
      border-radius:var(--radius); padding:16px;
      box-shadow:0 6px 20px rgba(13,27,42,.06);
    }
    .card h3{margin:0 0 4px;font-weight:900}
    .card .sub{color:var(--muted);font-size:14px;margin-bottom:10px}

    .score-badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:6px 12px;border-radius:999px;color:#fff;
      font-weight:800;letter-spacing:.5px
    }
    /* é¡è‰²è¦å‰‡ */
    .s-green{background:linear-gradient(180deg,#46d391,#09b364)}
    .s-blue {background:linear-gradient(180deg,#5aa2ff,#2f6feb)}
    .s-amber{background:linear-gradient(180deg,#ffc64b,#f2a500)}
    .s-red  {background:linear-gradient(180deg,#ff7878,#e14d4d)}

    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 12px}
    .chip{
      background:var(--chip); border:1px solid #e7ecf4; color:#192734;
      padding:8px 10px;border-radius:999px; font-weight:700; font-size:14px
    }

    .actions{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:8px
    }
    .btn{
      flex:1 1 110px;
      background:#fff;border:1px solid #dfe6ef;color:#0d1b2a;
      padding:10px 12px;border-radius:12px;font-weight:800;cursor:pointer
    }
    .btn:hover{border-color:#c8d2df}
    .btn .emo{font-size:18px;margin-right:6px}

    /* Modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(13,27,42,.45);
      display:none;place-items:center;z-index:50;padding:18px
    }
    .modal{max-width:680px;width:100%;background:#fff;border-radius:18px;border:1px solid #e8edf4;box-shadow:0 16px 40px rgba(13,27,42,.24)}
    .modal header{position:relative;background:#fff;color:#0d1b2a;padding:14px 18px;border-bottom:1px solid #eef2f7;box-shadow:none}
    .modal header h3{margin:0;font-size:20px;font-weight:900}
    .modal .content{padding:16px}
    .modal .close{
      position:absolute;right:12px;top:10px;border:none;background:#f2f5fa;border:1px solid #e4e9f2;border-radius:10px;padding:6px 10px;font-weight:800;cursor:pointer
    }

    /* é å°¾å°å­— */
    footer{padding:32px 16px;color:#77808c;text-align:center;font-size:12px}
    .legend{display:flex;gap:22px;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:10px}
    .dot{display:inline-block;width:12px;height:12px;border-radius:50%}
    .dot.g{background:#46d391} .dot.b{background:#2f6feb}
    .dot.a{background:#f2a500} .dot.r{background:#e14d4d}
  </style>
</head>
<body>

  <header>
    <div class="title">TripRadar</div>
    <div class="subtitle">è¡Œå‰ 1 åˆ†é˜ï½œå»ºè­°æ—…éŠåˆ†æ•¸ ï¼‹ ä¸€å¥å»ºè­°</div>
    <div class="toolbar">
      <span class="pill">æ›´æ–°æ™‚é–“ï¼š<span id="ts">â€”</span>ï¼ˆ<span id="mode">å¿«å–</span>ï¼‰</span>
      <button class="btn-refresh" id="btnReload">é‡æ–°æŠ“å–</button>
    </div>
  </header>

  <main>
    <div class="filters">
      <label class="switch">
        <input type="checkbox" id="useGeo" checked />
        <span>ä½¿ç”¨æ‰€åœ¨åœ°åŠ æ¬Š</span>
      </label>

      <div class="select">
        <span class="muted">æ‰‹å‹•æ‰€åœ¨åœ°ï¼š</span>
        <select id="selCity">
          <option value="è‡ºåŒ—å¸‚">è‡ºåŒ—å¸‚</option>
          <option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
          <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option>
          <option value="æ–°ç«¹å¸‚" selected>æ–°ç«¹å¸‚</option>
          <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option>
          <option value="è‡ºä¸­å¸‚">è‡ºä¸­å¸‚</option>
          <option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
          <option value="è‡ºå—å¸‚">è‡ºå—å¸‚</option>
          <option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
          <option value="å±æ±ç¸£">å±æ±ç¸£</option>
          <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option>
          <option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
          <option value="è‡ºæ±ç¸£">è‡ºæ±ç¸£</option>
          <option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
          <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option>
          <option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
        </select>
      </div>
    </div>

    <div id="list" class="grid"></div>
  </main>

  <footer>
    <div class="legend">
      <span><i class="dot g"></i> â‰¥90 éå¸¸é©åˆå‡ºéŠ</span>
      <span><i class="dot b"></i> 75â€“89 é©åˆå‡ºéŠ</span>
      <span><i class="dot a"></i> 60â€“74 å°šå¯å‡ºéŠ</span>
      <span><i class="dot r"></i> &lt;60 å»ºè­°æ”¹æœŸ</span>
    </div>
    <div style="margin-top:12px;">Â© 2025 TripRadarï¼ˆDEMOï¼‰ï¼æœ¬é ç‚º GitHub Pages å±•ç¤ºç”¨</div>
  </footer>

  <!-- è³‡æ–™ä¾†æº Modal -->
  <div id="dlgSource" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <header>
        <h3>è³‡æ–™ä¾†æº</h3>
        <button class="close" data-close="dlgSource">é—œé–‰ Ã—</button>
      </header>
      <div class="content">
        <ul>
          <li>ä¸­å¤®æ°£è±¡ç½² CWAï¼šF-C0032-001ï¼ˆå¤©æ°£é å ±ï¼‰</li>
          <li>ç’°å¢ƒéƒ¨ç©ºå“ AQIï¼šaqx_p_432</li>
          <li>ç½å®³è³‡è¨Šï¼šNCDRï¼ˆç¤ºæ„ï¼‰</li>
        </ul>
        <p class="muted" style="margin-top:12px">* æœ¬ DEMO åƒ…ç¤ºæ„æ¼”ç®—æ³•èˆ‡ä»‹é¢ï¼šå¯¦éš›é€£ç·šæ™‚æœƒä¾ API å›å‚³å€¼è¨ˆç®—ã€‚</p>
      </div>
    </div>
  </div>

  <script>
    // ======== è³‡æ–™èˆ‡å·¥å…· ========
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    // 13 é¢¨æ™¯å€ï¼ˆç°¡åŒ–ï¼‰
    const SPOTS = [
      {name:"é˜¿é‡Œå±±", city:"å˜‰ç¾©ç¸£", lat:23.5089, lng:120.8069},
      {name:"å¤ªé­¯é–£", city:"èŠ±è“®ç¸£", lat:24.1648, lng:121.6216},
      {name:"æ—¥æœˆæ½­", city:"å—æŠ•ç¸£", lat:23.8659, lng:120.9160},
      {name:"è¥¿æ‹‰é›…", city:"è‡ºå—å¸‚", lat:23.1182, lng:120.4694},
      {name:"é¦¬ç¥–", city:"é€£æ±Ÿç¸£", lat:26.1600, lng:119.9490},
      {name:"æ¾æ¹–", city:"æ¾æ¹–ç¸£", lat:23.5711, lng:119.5797},
      {name:"æ±éƒ¨æµ·å²¸", city:"è‡ºæ±ç¸£", lat:22.8733, lng:121.1597},
      {name:"èŠ±æ±ç¸±è°·", city:"èŠ±è“®ç¸£", lat:23.9732, lng:121.6023},
      {name:"é‡‘é–€", city:"é‡‘é–€ç¸£", lat:24.4367, lng:118.3186},
      {name:"èŒ‚æ—", city:"é«˜é›„å¸‚", lat:22.8882, lng:120.6859},
      {name:"é›²å˜‰å—æ¿±æµ·", city:"é›²æ—ç¸£", lat:23.7123, lng:120.2054},
      {name:"åŒ—æµ·å²¸åŠè§€éŸ³å±±", city:"æ–°åŒ—å¸‚", lat:25.2831, lng:121.5637},
      {name:"æ±åŒ—è§’æš¨å®œè˜­æµ·å²¸", city:"å®œè˜­ç¸£", lat:24.9933, lng:121.9175}
    ];

    // Demoï¼šè‹¥ç„¡æ³•è·¨åŸŸå– OpenDataï¼Œçµ¦ä¸€çµ„ç©©å®šåƒæ•¸
    function mockNow(){
      // ç›¡é‡æ¥è¿‘å¸¸è¦‹å€¼ï¼šTã€POPã€AQIã€UV
      return {T:24, POP:20, AQI:45, UV:6};
    }

    // è¨ˆåˆ†ï¼šBase = (TÃ—0.25 + RÃ—0.35 + AÃ—0.25 + UÃ—0.15)
    // é€™è£¡æŠŠæŒ‡æ¨™è½‰æ›åˆ° 0~100ï¼šè¶Šèˆ’é©åˆ†æ•¸è¶Šé«˜ï¼ˆç°¡åŒ–æ˜ å°„ï¼‰
    function metricScore(now){
      // æº«åº¦ 18â€“28 æœ€èˆ’é©, æ¯å 1Â°C -6 åˆ†
      let t = 70 - Math.abs(now.T - 23) * 6; // å– 23 åšä¸­ä½
      t = Math.max(0, Math.min(100, t));

      // é™é›¨æ©Ÿç‡ 100% -> 0 åˆ†ï¼Œ0% -> 100 åˆ†
      let r = 100 - now.POP;
      // AQI æ¯ +1 -> -0.8 åˆ†ï¼ˆ0 æœ€ä½³ï¼‰
      let a = Math.max(0, 100 - now.AQI*0.8);
      // UVï¼šé è¨­ 70 åˆ†ï¼ŒUV é«˜ç•¥é™
      let u = Math.max(0, 70 - (now.UV-6)*5);

      let base = (t*0.25 + r*0.35 + a*0.25 + u*0.15);
      return Math.round(base);
    }

    // åŠ æ¬Šï¼šåŒç¸£å¸‚ +5ï¼›é è· >200km -5ï¼›é›¢å³¶å·®ç•° -10ï¼ˆç¤ºæ„ï¼‰
    function weighted(base, spot, userCity){
      let w = 0;
      if (spot.city === userCity) w += 5;

      // ç²—ç•¥è·é›¢ï¼ˆä¸æŠ“å®šä½ï¼Œç”¨åŸå¸‚åè¿‘ä¼¼ï¼‰ï¼šé›¢å³¶å°± -5
      if (["é‡‘é–€ç¸£","é€£æ±Ÿç¸£","æ¾æ¹–ç¸£"].includes(spot.city) && spot.city !== userCity) {
        w -= 5;
      }
      // é è· -5ï¼ˆç¤ºæ„ï¼‰
      if (spot.city !== userCity) w -= 5;

      return Math.max(0, Math.min(100, base + w));
    }

    function scoreColor(s){
      if (s>=90) return "s-green";
      if (s>=75) return "s-blue";
      if (s>=60) return "s-amber";
      return "s-red";
    }

    // åœ°åœ–ï¼šä¸€éµåˆ°é»ï¼ˆé–‹å•Ÿ Apple/Google Maps pointï¼‰
    function openMapAt(lat,lng,name){
      const ios = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
      if (ios){
        location.href = `http://maps.apple.com/?ll=${lat},${lng}&q=${encodeURIComponent(name)}`;
      }else{
        location.href = `https://maps.google.com/?q=${encodeURIComponent(name)}@${lat},${lng}`;
      }
    }

    // åœ°åœ–ï¼šå°èˆªï¼ˆfrom current â†’ ç›®çš„åœ°ï¼‰
    function navigateTo(lat,lng,name){
      const ios = /iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase());
      if (ios){
        location.href = `http://maps.apple.com/?daddr=${lat},${lng}&dirflg=d`;
      }else{
        location.href = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&travelmode=driving`;
      }
    }

    // è³‡æ–™ä¾†æºè¦–çª—
    function openSource(){ $("#dlgSource").style.display="grid"; }
    function closeDialog(id){ $("#"+id).style.display="none"; }
    $$("#dlgSource [data-close]").forEach(btn=>btn.addEventListener("click", e=>{
      closeDialog(e.currentTarget.dataset.close);
    }));
    $("#dlgSource").addEventListener("click", (e)=>{
      if (e.target.id==="dlgSource") closeDialog("dlgSource");
    });

    // ======== ç•«é¢æ¸²æŸ“ ========
    const $list = $("#list");
    const $selCity = $("#selCity");
    const $useGeo = $("#useGeo");
    const $ts = $("#ts");
    const $mode = $("#mode");
    $("#btnReload").addEventListener("click", render);

    function createCard(spot, now, base, final){
      const c = document.createElement("div");
      c.className = "card";
      const color = scoreColor(final);
      c.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
          <div>
            <h3>${spot.name}</h3>
            <div class="sub">${spot.city}</div>
          </div>
          <div class="score-badge ${color}">å»ºè­°æ—…éŠåˆ†æ•¸ ${final}</div>
        </div>

        <div class="chips">
          <span class="chip">ğŸŒ¡ï¸ ${now.T}Â°C</span>
          <span class="chip">ğŸŒ§ï¸ ${now.POP}%</span>
          <span class="chip">â˜€ï¸ UV ${now.UV}</span>
          <span class="chip">ğŸ«§ AQI ${now.AQI}</span>
        </div>

        <div class="actions">
          <button class="btn" data-act="go"   data-lat="${spot.lat}" data-lng="${spot.lng}" data-name="${spot.name}"><span class="emo">ğŸ“</span>ä¸€éµåˆ°é»</button>
          <button class="btn" data-act="nav"  data-lat="${spot.lat}" data-lng="${spot.lng}" data-name="${spot.name}"><span class="emo">ğŸ—ºï¸</span>åœ°åœ–å°èˆª</button>
          <button class="btn" data-act="src"><span class="emo">ğŸ“„</span>è³‡æ–™ä¾†æº</button>
        </div>
      `;
      c.querySelectorAll(".btn").forEach(b=>{
        b.addEventListener("click",()=>{
          const act = b.dataset.act;
          if (act==="go")  openMapAt(b.dataset.lat, b.dataset.lng, b.dataset.name);
          if (act==="nav") navigateTo(b.dataset.lat, b.dataset.lng, b.dataset.name);
          if (act==="src") openSource();
        });
      });
      return c;
    }

    async function render(){
      // æ™‚æˆ³
      const nowTs = new Date();
      $ts.textContent = nowTs.toISOString().slice(0,16).replace("T"," ");
      $mode.textContent = "å¿«å–";

      const userCity = $selCity.value;
      $list.innerHTML = "";

      for (const spot of SPOTS){
        // ç°¡åŒ–ï¼šè¦æ¥ API çš„è©±ï¼ŒæŠŠ mockNow() æ›æˆçœŸå¯¦ fetch çµæœ
        const now = mockNow();
        const base = metricScore(now);
        const final = $useGeo.checked ? weighted(base, spot, userCity) : base;
        $list.appendChild(createCard(spot, now, base, final));
      }
    }

    render();
  </script>
</body>
</html>
